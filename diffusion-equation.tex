\section{The Diffusion Equation}
\label{sec:Diffusion}

The diffusion equation is derived from the \gls{nte} by making some simplifying assumptions regarding the angular dependence of the angular flux. Before we reach this conclusion, however, we should explore two possible methods in which we might obtain a \gls{pde} strictly in terms of the scalar flux \(\phi\) and scalar current \(\vv{J}\), defined as:

\beq
\label{eq:ScalarFluxDef}
\phi\sset\equiv\int_{4\pi}d\hO\psi\seat
\eeq

\beq
\label{eq:Current}
\vv{J}(\vv{r},E,t)\equiv\int_{4\pi}^{}d\hO  \vv{j}\seat
\eeq

Our first attempt to obtain an equation solely in terms of \(\phi\) will be to integrate the \gls{nte} in Eq. \eqref{eq:nte1} over angle, using the definitions of scalar flux and current in Eqs. \eqref{eq:ScalarFluxDef} and \eqref{eq:Current}:

\beqa
\label{eq:NeutronContinuityEquation}
&\frac{\partial}{\partial t}\left(\frac{\phi\sset}{v(E)}\right)+\nabla\cdot\vv{J}\sset+\Sigma_t\sset\phi\sset=\\
&\hspace{1cm}\int_{4\pi}d\hO\inscatteringsource\psi\seatelse+\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\dEprime\left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)+\\
&\hspace{3cm}\int_{4\pi}d\hO\delayedfissionsource+S\sset
\eeqa

The time term is obtained by expanding via the chain rule, integrating in angle (by noting that the time derivative in the \(\partial/\partial t\) operator can be brought outside the integral due to its lack of dependence on angle, and then brought back in after introducing \(\phi\)), and collapsing the chain rule. The streaming term was written as an area integral by reversing the divergence rule, and then re-applying the divergence rule after angle integration. The fission and total cross sections have been assumed independent of angle such that they could be brought outside the angle integration, as is commonplace. 

The inscattering source term requires additional effort to switch the order of integration of \(\hO'\) and \(\hO\). By assuming rotational symmetry such that Eq. \eqref{eq:OmegaDotOmega} holds, the single differential scattering cross section is defined by integrating over \(\hO\):

\beqa
\label{eq:SingleDifferentialSigma_s}
\Sigma_s(\vv{r},E'\rightarrow E,t)\equiv&\int_{4\pi}d\hO \Sigma_s\seatout\\
=&\ 2\pi\int_{-1}^1d\mu\Sigma_s(\vv{r},E'\rightarrow E,\mu,t)
\eeqa

Switching the order of angle integrations in the in-scattering term and inserting the definition in Eq. \eqref{eq:SingleDifferentialSigma_s} gives:

\beqa
\label{eq:NeutronContinuityEquation1}
&\frac{\partial}{\partial t}\left(\frac{\phi\sset}{v(E)}\right)+\nabla\cdot\vv{J}\sset+\Sigma_t\sset\phi\sset=\\
&\hspace{1cm}\dEprime\Sigma_s(\vv{r},E'\rightarrow E,t)\phi(\vv{r},E',t)+\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\dEprime\left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)+\\
&\hspace{3cm}\int_{4\pi}d\hO\delayedfissionsource+S\sset
\eeqa

Eq. \eqref{eq:NeutronContinuityEquation1} is sometimes referred to as the ``neutron continuity'' equation, since it represents an equivalent statement of neutron conservation, similar to mass conservation in fluid mechanics and the ``mass continuity'' equation. Note that attempting to integrate out all angular dependence has introduced \(\vv{J}\), which has no exact relationship with \(\phi\). We will seek a \gls{pde} that is a function of strictly \(\vv{J}\), rather than both \(\vv{J}\) and \(\phi\), by multiplying the \gls{nte} by \(\hO\) and then integrating in angle. Because \(\hO\) is a vector, this corresponds to the multiplication of the \gls{nte} by each component of \(\hO\) and summing. 

\beqa
\label{eq:TEAngleAngleIntegrated2}
&\frac{\partial}{\partial t}\left(\frac{\vv{J}\sset}{v(E)}\right)+\nabla\cdot\int_{4\pi}d\hO\psi\seat\hO\hO+\Sigma_t\sset\vv{J}\sset=\\
&\hspace{1cm}\int_{4\pi}d\hO\inscatteringsource\psi(\vv{r},E',\hO',t)\hO\ +\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\hO\dEprime \left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)\ +\\
&\hspace{3cm}\int_{4\pi}d\hO\hO\delayedfissionsource+\int_{4\pi}d\hO S\seat\hO
\eeqa

The time term is obtained by expanding via the chain rule, integrating in angle (by noting that the time derivative in the \(\partial/\partial t\) operator can be brought outside the integral due to its lack of dependence on angle, and then brought back in after introducing \(\phi\)), and collapsing the chain rule. The gradient is brought outside the angular integral in the streaming term because the operator is independent of angle. Again, the total and fission cross sections are assumed independent of angle such that they can be brought outside the angle integration, with the definition of scalar flux in Eq. \eqref{eq:ScalarFluxDef} used in the fission source term. If the prompt and/or delayed fission spectra are isotropic, then the first moments of \(\chi_p\) and \(\chi_d\) are zero, and the fission source terms are zero. Likewise, the external source integral represents the first moment of the external source, which will be zero if the external source is isotropic.

The inscattering source term again requires some additional effort and tracking of the multiplication by each component of \(\hO\). The \(x\)-component multiplication, with the angle order of integration swapped, reads as:

\beq
\label{eq:Inscat1}
\int_{4\pi}d\hO'\dEprime \int_{4\pi}d\hO\Sigma_s\seatout\psi\seatelse\Omega_x
\eeq

Because \(\hO\) and \(\hO'\) are unit vectors, Eq. \eqref{eq:Inscat1} can be multiplied by \(\hO'\cdot\hO'\equiv1\):

\beq
\label{sec:Inscat1}
\int_{4\pi}d\hO'\dEprime \int_{4\pi}d\hO\Sigma_s\seatout\psi\seatelse\Omega_x\hO'\cdot\hO'
\eeq

Assuming rotational symmetry such that \(\Sigma_s\) depends on \(\hO\cdot\hO'\) rather than the initial and final angle states individually, we express \(\Sigma_s\) in terms of \(\mu\) and write \(\hO'\cdot\hO'\) as \(\Omega'_i\Omega'_i\), where \(i=x\), \(y\), and \(z\), which can be written solely in terms of the \(x\)-component by including an extra factor of 3:

\beq
\label{sec:Inscat2}
3\int_{4\pi}d\hO'\dEprime \int_{4\pi}d\hO\Sigma_s(\vv{r},E'\rightarrow E,\hO'\cdot\hO,t)\psi\seatelse\Omega_x\Omega'_x\Omega'_x
\eeq

Now, by recognizing that the dot product between directions of motion can be reversed from \(\hO'\cdot\hO'\) to \(\hO'\cdot\hO\) gives the following:

\beq
\label{eq:Inscat2}
\dEprime \Sigma_{s,1}(\vv{r},E'\rightarrow E,t)\vv{J}(\vv{r},E',t)
\eeq

where the definition of current from Eq. \eqref{eq:Current} has been used and the first moment of the scattering cross section is defined as:

\beq
\Sigma_{s,1}(\vv{r},E'\rightarrow E,t)\equiv 2\pi\int_{-1}^1d\mu\Sigma_s(\vv{r},E'\rightarrow E,\mu,t)\mu 
\eeq

Combining Eq. \eqref{eq:TEAngleAngleIntegrated2} with the form of the in-scattering source in Eq. \eqref{eq:Inscat2} gives:

\beqa
\label{eq:TEAngleAngleIntegrated2v2}
&\frac{\partial}{\partial t}\left(\frac{\vv{J}\sset}{v(E)}\right)+\nabla\cdot\int_{4\pi}d\hO\psi\seat\hO\hO+\Sigma_t\sset\vv{J}\sset=\\
&\hspace{1cm}\dEprime \Sigma_{s,1}(\vv{r},E'\rightarrow E,t)\vv{J}(\vv{r},E',t)+\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\hO\dEprime \left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)+\\
&\hspace{3cm}\int_{4\pi}d\hO\hO\delayedfissionsource+\int_{4\pi}d\hO S\seat\hO
\eeqa

As can be seen in Eq. \eqref{eq:TEAngleAngleIntegrated2v2}, attempting to obtain an equation solely in terms of \(\vv{J}\) has been unsuccessful due to the streaming term. Because the streaming term is the only term that contains a factor of \(\hO\), each multiplication by \(\hO\) and integration over angle will introduce a new term that we cannot express analytically in terms of \(\vv{J}\) or \(\phi\). So, the diffusion equation cannot be derived by simply integrating angular dependence from the \gls{nte} or by performing other tricks like first multiplying by \(\hO\) and then integrating over angle. 

At this point, it is clear that a simpler version of the \gls{nte} in terms of solely \(\phi\) or \(\vv{J}\) cannot be derived, and a more explicit assumption regarding the angular dependence of the angular flux must be made. The diffusion equation is derived from the angle-integrated \gls{nte} in Eq. \eqref{eq:NeutronContinuityEquation1} by assuming a \(P_1\) expansion for the angular dependence of the angular flux according to the form in Eq. \eqref{eq:ScatteringLegendre}:

\beqa
\label{eq:FluxLegendreP1}
\psi\seat\approx&\sum_{l=0}^1\frac{2l+1}{4\pi}\psi_l\sset P_l(\hO)\\
=&\frac{1}{4\pi}\psi_0\sset+\frac{3}{4\pi}\psi_1\sset\hO\\
\eeqa
%\frac{1}{4\pi}\phi\sset+\frac{3}{4\pi}\vv{J}\sset\hO

where \(\psi_l\) is the \(l\)-th moment of the angular flux. Based on the definitions of the first few Legendre polynomials in Eq. \eqref{eqn:LegendrePolynomials_P0P1P2}, a \(P_1\) approximation is equivalent to assuming linear anisotropy in the angular flux. Using a linear approximation for anisotropy is reasonably accurate if the angular flux is only weakly dependent on angle. To interpret the physical meaning of the flux moments \(\psi_0\) and \(\psi_1\), integrate Eq. \eqref{eq:FluxLegendreP1} over angle:

\beqa
\label{eq:FluxLegendreP1_AngleIntegration}
\int_{4\pi}^{} d\hO\psi\seat=& \frac{1}{4\pi}\int_{4\pi}^{}d\hO\psi_0\sset +\frac{3}{4\pi}\int_{4\pi}^{} d\hO \psi_1\sset\hO\\
\phi\spas = &\ \psi_0 + \frac{3}{4\pi}\psi_1\int_{4\pi}^{} d\hO  \hO\\
   = &\ \psi_0
\eeqa

where Eqs. \eqref{eq:SolidAngleIntegration} and \eqref{eq:OmegaCartesianIntegration} have been used. Eq. \eqref{eq:FluxLegendreP1_AngleIntegration}  shows that the zero-th moment of the angular flux is equivalent to the scalar flux. In other words, the scalar flux represents the angular flux with all angular dependence ``averaged out.'' To interpret \(\psi_1\), multiply Eq. \eqref{eq:FluxLegendreP1} by \(\hO\) and then integrate over solid angle:

\beqa
\label{eq:FluxLegendreP1_AngleIntegration2}
\int_{4\pi}^{} d\hO   \hO  \psi\spa  =& \frac{1}{4\pi}\int_{4\pi}^{} d\hO   \hO  \psi_0\sset + \frac{3}{4\pi}\int_{4\pi}^{} d\hO   \hO   \hO  \psi_1\sset\\
\vv{J}\sset = &\ \psi_1\sset\\
\eeqa

where Eqs. \eqref{eq:OmegaCartesianIntegration} and \eqref{eq:4PiOmegaOmega} have been used. Eq. \eqref{eq:FluxLegendreP1_AngleIntegration2} shows that the first moment of the angular flux is equivalent to the current. Eqs. \eqref{eq:FluxLegendreP1_AngleIntegration} and \eqref{eq:FluxLegendreP1_AngleIntegration2} are also obvious simply from their definitions in Eqs. \eqref{eq:ScalarFluxDef} and \eqref{eq:Current}. Inserting the expansion in Eq. \eqref{eq:FluxLegendreP1} into Eq. \eqref{eq:TEAngleAngleIntegrated2v2} for \(\psi\) gives:

\beqa
\label{eq:P1a}
&\frac{\partial}{\partial t}\left(\frac{\vv{J}\sset}{v(E)}\right)+\frac{1}{3}\nabla\phi(\vv{r},E,t)+\Sigma_t\sset\vv{J}\sset=\\
&\hspace{1cm}\dEprime \Sigma_{s,1}(\vv{r},E'\rightarrow E,t)\vv{J}(\vv{r},E',t)+\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\hO\dEprime \left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)+\\
&\hspace{3cm}\int_{4\pi}d\hO\hO\delayedfissionsource+\int_{4\pi}d\hO S\seat\hO
\eeqa

where Eqs. \eqref{eq:4PiOmegaOmega} and \eqref{eq:4PiOmegaOmegaOmega} have been used to simplify the streaming term. When combined with the neutron continuity equation in Eq. \eqref{eq:NeutronContinuityEquation1} (which makes no assumptions regarding expansion of the angular dependence of the angular flux), Eqs. \eqref{eq:P1a} and \eqref{eq:NeutronContinuityEquation1} are equivalent to the \(P_1\) equations, since the approximation of linearly anisotropic angular dependence in the angular flux is equivalent to a first-order expansion in Legendre polynomials in the one-dimensional space \(\hO=\mu\hat{k}\). Rather than solve Eqs. \eqref{eq:NeutronContinuityEquation1} and \eqref{eq:P1a} in a coupled sense for four unknowns (\(\phi\) and three components of \(\vv{J}\)), two additional simplifications will yield a single equation in terms of \(\phi\) alone, known as the diffusion equation. To obtain the diffusion equation, we assume that the fission and external sources are isotropic such that the first moments of the fission and external sources that appear in Eq. \eqref{eq:P1a} are zero. We also assume that the time rate of change of the current relative to the total interaction rate is negligible such that the time-dependent term in Eq. \eqref{eq:P1a} can be neglected:

\beq
\frac{\partial}{\partial t}\left(\frac{\vv{J}}{v}\right)\ll\Sigma_t\vv{J}
\eeq

Combining these two assumptions simplifies Eq. \eqref{eq:P1a} to:

\beq
\label{eq:P1b}
\frac{1}{3}\nabla\phi(\vv{r},E,t)+\Sigma_t\sset\vv{J}\sset=\dEprime \Sigma_{s,1}(\vv{r},E'\rightarrow E,t)\vv{J}(\vv{r},E',t)
\eeq

Eq. \eqref{eq:P1b} can be reorganized to give an expression for \(\vv{J}\) in terms of \(\phi\) to remove \(\vv{J}\) as an independent variable in Eq. \eqref{eq:NeutronContinuityEquation1}. If scattering were isotropic in the lab frame, \(\Sigma_{s,1}=0\), and Eq. \eqref{eq:P1b} would simplify nicely to a relationship between \(\vv{J}\) and \(\phi\). However, isotropic scattering is far too simple an approximation for most nuclear engineering systems, so instead we define an energy-dependent diffusion coefficient \(D\):

\beq
\label{eq:DiffusionCoeff}
D(\vv{r},E,t)\equiv\frac{1}{3}\left\lbrack\Sigma_t(\vv{r},E,t)-\frac{\dEprime \Sigma_{s,1}(\vv{r},E'\rightarrow E,t)J_i(\vv{r},E',t)}{J_i(\vv{r},E,t)}\right\rbrack^{-1}
\eeq

which gives the diffusion-like relationship between flux and current:

\beq
\label{eq:FicksLaw}
\vv{J}=-D\nabla\phi
\eeq

Relationships of the type shown in Eq. \eqref{eq:FicksLaw} are often referred to as ``Fick's law.'' No exact relationship exists between \(\vv{J}\) and \(\phi\) - the relationships shown in Eqs. \eqref{eq:DiffusionCoeff} and \eqref{eq:FicksLaw} arise from the \(P_1\) equations (which assumes a certain level of angular anisotropy) with the additional assumption of isotropic sources and small time rate of change of the current. 

The definition of the diffusion coefficient in Eq. \eqref{eq:DiffusionCoeff} is not particularly useful, since its definition depends on the current, which is unknown. A simpler expression for the diffusion coefficient can be obtained by assuming that the contribution to the energy transfer in a scattering collision is purely isotropic, that is:

\beq
\label{eq:IsotropicEnergyTransfer}
\Sigma_{s,1}(\vv{r},E'\rightarrow E,t)=\Sigma_{s,1}(\vv{r},E,t)\delta(E'-E)
\eeq

Inserting Eq. \eqref{eq:IsotropicEnergyTransfer} into Eq. \eqref{eq:DiffusionCoeff} gives an explicit expression for the diffusion coefficient:

\beqa
\label{eq:DiffusionCoeff2}
D(\vv{r},E,t)=&\frac{1}{3}\left\lbrack\Sigma_t(\vv{r},E,t)-\frac{\dEprime \bar{\mu}\Sigma_{s}(\vv{r},E,t)\delta(E'-E)J_i(\vv{r},E',t)}{J_i(\vv{r},E,t)}\right\rbrack^{-1}\\
=&\frac{1}{3\left\lbrack\Sigma_t(\vv{r},E,t)-\bar{\mu}\Sigma_{s}(\vv{r},E,t)\right\rbrack}\\
\eeqa

where \(\bar{\mu}\) is the average of the cosine of the scattering angle weighted with respect to the total scattering cross section:

\beqa
\label{eq:AverageMuDef}
\bar{\mu}\equiv&\langle\hO\cdot\hO'\rangle\\
=&\frac{\int_{4\pi}d\hO\Sigma_s(\vv{r},E,\hO\cdot\hO',t)\hO\cdot\hO'}{\int_{4\pi}d\hO\Sigma_s(\vv{r},E,\hO\cdot\hO',t)}\\
=&\frac{\Sigma_{s,1}(\vv{r},E,t)}{\Sigma_s(\vv{r},E,t)}
\eeqa

Eq. \eqref{eq:OmegaDotOmega} is used to provide the interpretation of \(\bar{\mu}\) representing the average of the cosine of the angle between the incoming and outgoing scattering directions of motion. Nuclides with more significant forward scattering, such as the lighter elements, will have larger diffusion coefficients. % TODO: Eqatuions 4-127 through 4-129 after reading earlier chapters

Additional motivation for the use of Eq. \eqref{eq:DiffusionCoeff} as a definition for the diffusion coefficient require knowledge of the neutron slowing down process. Alternatively, corrections may be made to the simpler diffusion coefficient in Eq. \eqref{eq:DiffusionCoeff2} to better account for anisotropic energy transfer in scattering.

Insertion of Eq. \eqref{eq:FicksLaw} into the neutron continuity equation in Eq. \eqref{eq:NeutronContinuityEquation1} gives the diffusion equation:

\beqa
\label{eq:DiffusionEquation}
&\frac{\partial}{\partial t}\left(\frac{\phi(\vv{r},E,t)}{v(E)}\right)-\nabla\cdot\left\lbrack D\nabla\phi(\vv{r},E,t)\right\rbrack+\Sigma_t\sset\phi\sset=\\
&\hspace{1cm}\dEprime\Sigma_s(\vv{r},E'\rightarrow E,t)\phi(\vv{r},E',t)+\\
&\hspace{2cm}\int_{4\pi}d\hO\chi_p(E,\hO)\dEprime\left\lbrack1-\beta(E')\right\rbrack\nu(E')\Sigma_f(\vv{r},E',t)\phi(\vv{r},E',t)+\\
&\hspace{3cm}\int_{4\pi}d\hO\delayedfissionsource+S\sset
\eeqa

Several assumptions were made in the mathematical derivation of the diffusion equation. These are summarized here as follows:

\begin{enumerate}
\item The angular flux is only linearly dependent on angle due to the use of the \(P_1\) approximation for the angular flux dependence. For this reason, the diffusion approximation is typically invalid near boundaries or regions with large variation in cross section that induce a stronger directional dependence in the angular flux.
\item The rate of change of the current is much smaller than the characteristic time scale of nuclear interactions
\end{enumerate}

A separate set of assumptions are implicitly present when the diffusion equation is used as a model for neutron transport. These assumptions are summarized here as follows:

\begin{enumerate}
\item Neutron collisions occur very frequently and result in neutron travel being well-approximated as a ``random-walk'' process. This may be a good approximation for very homogeneous media, but for heterogeneous media where the neutron mean free path is of the same order as important geometrical features, neutrons may stream large distances relative to the characteristic dimensions of the problem, invalidating the random-walk assumption. For this reason, the diffusion approximation is typically invalid when the neutron mean free path is larger than the characteristic dimensions of the system % TODO: put in approximate values for mfp's for fast and thermal neutrons 
\end{enumerate}

A transport cross section is commonly defined as:

\beq
\label{eq:TransportSigma}
\Sigma_{tr}(\vv{r},E,t)\equiv\Sigma_t(\vv{r},E,t)-\bar{\mu}\Sigma_s(\vv{r},E,t)
\eeq

The transport mean free path, or \(1/\Sigma_{tr}\), is essentially a corrected mean free path that accounts for anisotropies in the elastic scattering process. Because neutrons are biased towards forward scattering, the transport mean free path is larger than the actual mean free path \(1/\Sigma_t\). 

\subsection{The Multigroup Diffusion Equation}

The diffusion equation in Eq. \eqref{eq:DiffusionEquation} can be written in \gls{mg} form by integrating over energy group \(E_{g-1}\leq E\leq E_g\) as was performed in the derivation of the \gls{mg} transport equation in Section \ref{sec:MGNTE}. Similar to the definitions provided in Section \ref{sec:MGNTE} for groupwise fluxes and cross sections, the groupwise flux and cross sections are defined here as:

\beq
\phi_g(\vv{r},t)\equiv\int_{E_{g-1}}^{E_g}dE\phi(\vv{r},E,t)
\eeq

\beqa
\Sigma_{i,g}(\vv{r},t)\equiv&\frac{\int_{E_{g-1}}^{E_g}dE\Sigma_f(\vv{r},E,t)\phi(\vv{r},E,t)}{\int_{E_{g-1}}^{E_g}dE\phi(\vv{r},E,t)}\\
=&\frac{\int_{E_{g-1}}^{E_g}dE\Sigma_f(\vv{r},E,t)\phi(\vv{r},E,t)}{\phi_g(\vv{r},t)}\\
\eeqa

Integrating the diffusion equation in Eq. \eqref{eq:DiffusionEquation} over a single energy group and applying these definitions gives the \gls{mg} diffusion equation:

\beqa
\label{eq:MGDiffusionEquation}
\frac{\partial}{\partial t}\left(\frac{\phi_g(\vv{r},t)}{v_g}\right) %TODO
\eeqa

where the time derivative was brought outside the integration since this operator does not depend on energy. 

\subsection{The One-Group Diffusion Equation}
For a single energy group, Eq. \eqref{eq:MGDiffusionEquation} simplifies to:

\beqa
\label{eq:1GDiffusionEquation}
&\frac{1}{v}\frac{\partial\phi(\vv{r},t)}{\partial t}-\nabla\cdot\left\lbrack D\nabla\phi(\vv{r},t)\right\rbrack+\Sigma_a(\vv{r},t)\phi(\vv{r},t)=\\
&\hspace{1cm}\int_{4\pi}d\hO(1-\beta)\nu\Sigma_f(\vv{r},t)\phi(\vv{r},\hO,t)+\int_{4\pi}d\hO\sum_{j=1}^J\chi_{d,j}(\hO)\lambda_jC_j(\vv{r},t)+S(\vv{r},t)
\eeqa

The one-group diffusion equation is parabolic, and if the time derivative is neglected, has the form of a Helmholtz equation. The one-group diffusion equation provides a convenient simplification to develop a better understanding of neutron transport by investigating simple problems with analytic solutions. This will be the goal of this section. 

%TODO: 162-1796

Assuming uniform properties and dividing through by \(D\) shows that the neutron diffusivity, analogous to thermal diffusivity, is \(\Sigma_a/D\). The neutron diffusion length \(L\) is defined as follows for convenience:

\beq
\label{eq:DiffusionLength}
L\equiv\sqrt{\frac{D}{\Sigma_a}}
\eeq

\(L\) is proportional to the distance traveled by a neutron from a source to absorption; the exact proportionality differs based on the assumed coordinate system. 

\subsection{Boundary Conditions}

The \glspl{bc} for the diffusion equation will be derived from those for the \gls{nte} shown in Eq. \eqref{eq:NTEBCs}. At interfaces of two different cross sections \(1\) and \(2\), continuity of the angular flux cannot be exactly satisfied. However, integration of Eq. \eqref{eq:NTE_interface} with respect to solid angle, and multiplication by \(\hO\) and integration with respect to solid angle, shows that at a minimum diffusion theory can require the first two moments of the angular flux to be continuous at interfaces:

\beq
\phi_1(\vv{r}_s,E,t)=\phi_2(\vv{r}_s,E,t)
\eeq

\beq
\label{eq:ContinuityCurrent}
\vv{J}_1(\vv{r}_s,E,t)=\vv{J}_2(\vv{r}_s,E,t)
\eeq

If a thin source of neutrons is present at an interface boundary, Eq. \eqref{eq:ContinuityCurrent} is modified so that the dot product of the different in the currents equals the magnitude of the source.

At vacuum boundaries, transport theory requires \(\psi_{inc}=0\) for \(\hO\cdot\hat{n}<0\). Similar to continuity of the scalar flux and current, diffusion theory can only satisfy this \gls{bc} in an average sense:

\beqa
\label{eq:DiffusionVacuumBC}
\int_{\hO\cdot\hat{n}<0}d\hO\psi(\vv{r}_s,E,\hO,t)\hO\cdot\hat{n}=&\ 0\\
\vv{J}_{-}(\vv{r}_s,E,t)=&\ 0\\
\eeqa

where the definition of current from Eq. \eqref{eq:Current} has been used, and a subscripted notation of \(\pm\) is used to indicate the outward (\(+\)) or inward (\(-\)) current:

\begin{subequations}
\label{eq:PartialCurrentDef}
\begin{eqnarray}
\vv{J}_+(\vv{r},E,t)&\equiv&\int_{\hO\cdot\hat{n}>0}d\hO\psi\seat\hO\cdot\hat{n}\\
\vv{J}_-(\vv{r},E,t)&\equiv&\int_{\hO\cdot\hat{n}<0}d\hO\psi\seat\hO\cdot\hat{n}
\end{eqnarray}
\end{subequations}

The diffusion theory equivalent of the transport vacuum \gls{bc} of zero incoming flux in Eq. \eqref{eq:DiffusionVacuumBC} is obtained as a function of \(\phi\) by finding the partial currents \(\vv{J}_\pm\) as a function of \(\phi\) by inserting the \(P_1\) approximation in Eq. \eqref{eq:FluxLegendreP1} into Eq. \eqref{eq:PartialCurrentDef}:

\beqa
\label{eq:PartialCurrent_BC1}
\vv{J}_\pm\sset=&\int_{2\pi\pm}d\hO\left\lbrack\frac{1}{4\pi}\phi\sset-\frac{3}{4\pi}D\nabla\phi\sset\hO\right\rbrack\hO\cdot\hat{n}\\
=&\frac{1}{4\pi}\phi\sset\mp\frac{1}{2}D\nabla\phi\sset\cdot\hat{n}
\eeqa

where \(2\pi\pm\) has replaced integration over the entire solid angle \(4\pi\) because the outgoing or incoming directions each correspond to half of the \(\theta\) direction. Inserting the diffusion approximation in Eq. \eqref{eq:FicksLaw} and recognizing that integration over half the solid angle results in Eqs. \eqref{eq:SolidAngleIntegration} and \eqref{eq:OmegaDotOmega} being halved gives the final simple form in terms of \(\phi\) alone. Eq. \eqref{eq:PartialCurrent_BC1} implies that if we linearly extrapolated the flux from the surface based on the value of the gradient at the surface, the flux is zero at a distance \(2D\) along the normal from the surface. Therefore, Eq. \eqref{eq:PartialCurrent_BC1} is frequently used in a simpler form as a Dirichlet \gls{bc}:

\beq
\phi(\vv{r}_s+2D\hat{n},E,t)=0
\eeq

Additional corrections from transport theory suggest that the extrapolation distance of \(2D\) for plane geometries is better replaced by \(0.7104/\Sigma_{tr}\). 

\subsubsection{One-Group Diffusion in Non-Multiplying Media}

This section provides the derivation of several classical solutions to the one-group diffusion equation in non-multiplying media, i.e. media in which \(\Sigma_f=0\) and there are no delayed fission neutron sources. We will also assume that the problem can be well-approximated by a steady-state solution. 

\subsubsubsection{Point Source in Infinite Spherical Coordinates}
\label{sec:1GDEPtSrcSpherical}
The easiest solution is for a point source in spherical coordinates. For this system, the one-group diffusion equation may be solved in all regions of space except \(r=0\); the flux must be finite at all locations and the source is assumed to emit isotropically with magnitude \(S_0\) particles/second, giving the following \glspl{bc}:

\begin{subequations}
\label{eq:1GDESphericalBCs}
\begin{eqnarray}
\lim_{r\rightarrow 0}4\pi r^2J(r)&=&S_0\\
\lim_{r\rightarrow\infty}\phi(r)&=&0
\end{eqnarray}
\end{subequations}

where the \gls{bc} on the current at \(r=0\) is adjusted to obtain the correct units. The steady-state one-group diffusion equation in spherical coordinates to be solved is:

\beq
\label{eq:1GDESpherical}
\frac{1}{r^2}\frac{\partial}{\partial r}\left(r^2\frac{\partial\phi}{\partial r}\right)-\frac{1}{L^2}\phi=0
\eeq

Eq. \eqref{eq:1GDESpherical} has the following solution:

\beq
\phi(r)=\frac{1}{r}\left( C_1e^{-r/L}+\cancel{C_2e^{r/L}}\right)
\eeq

where application of Eq. \eqref{eq:1GDESphericalBCs}b requires the coefficient \(C_2=0\) because in the limit of \(r\rightarrow\infty\), an exponential grows faster than \(r\). Application of Eq. \eqref{eq:1GDESphericalBCs}a gives the following flux solution:

\beq
\phi(r)=\frac{S_0}{4\pi D}\frac{e^{-r/L}}{r}
\eeq

The flux falls exponentially, with an additional geometric attenuation due to the change in surface area with distance from the source. Some additional analysis will support the claim that \(L\) is proportional to the average distance traveled by a neutron from the source to absorption. The probability of absorption at \(r\pm dr\) is obtained simply by dividing the absorption interaction rate \(\Sigma_a\phi\) by the strength of the source and multiplying by the differential volume \(4\pi r^2dr\):

\beq
p_{abs}(r)dr=\frac{\Sigma_a}{4\pi D}\frac{e^{-r/L}}{r}4\pi r^2dr
\eeq

The average of the square of the distance traveled by a neutron from the point source until absorption, \(\langle r^2\rangle\), is computed simply by weighting \(r^2\) by the probability of absorption defined above:

\beqa
\langle r^2\rangle\equiv\frac{1}{L^2}\int_{0}^\infty e^{-r/L} r^3dr
=&6L^2
\eeqa

where three successive applications of integration by parts has been used. As can be seen, the neutron diffusion length is linearly proportional to the \gls{rms} distance from birth at a point source to absorption in a non-multiplying medium. This analysis illustrates that, while the total path length traveled is likely much larger due to scattering collisions that don't lead to the death of a neutron, the average distance traveled from a source can be assessed based on \(L\). In media poorly-suited to diffusion theory, the definition of \(L\) above provides a means of determining an approximate diffusion coefficient. For example, if \(L^2\) is taken to represent the average square of the distance traveled from birth to absorption, a diffusion coefficient can be estimated from transport theory as:

\beq
\frac{\Sigma_a}{D}=\frac{\int r^2\phi(\vv{r})d\vv{r}}{\int \phi(\vv{r})d\vv{r}}
\eeq

\subsubsubsection{Planar Source in Infinite Cartesian Coordinates}

Very similar to the point source in infinite spherical coordinates in Section \ref{sec:1GDEPtSrcSpherical}, a planar source with strength \(S_0\) neutrons per area\(\cdot\)second located at \(x=0\) in Cartesian coordinates leads to a problem that can be solved analytically for \(x\neq0\) using the one-group diffusion equation. The \glspl{bc} for this problem become:

\begin{subequations}
\label{eq:1GDECartBCs}
\begin{eqnarray}
\lim_{x\rightarrow0}J(x)&=&S_0/2\\
\lim_{x\rightarrow\infty}\phi(x)&=&0
\end{eqnarray}
\end{subequations}

And the neutron diffusion equation in Cartesian coordinates is:

\beq
\frac{\partial^2\phi}{\partial x^2}-\frac{1}{L^2}\phi=0
\eeq

This equation has the solution:

\beq
\phi(x)=C_1e^{-x/L}+\cancel{C_2e^{x/L}}
\eeq

where application of Eq. \eqref{eq:1GDECartBCs}b requires \(C_2=0\) and application of Eq. \eqref{eq:1GDECartBCs}a gives the solution:

\beq
\phi(x)=\frac{S_0L}{2D}e^{-x/L}
\eeq

Performing a similar analysis as in spherical coordinates, the probability of absorption at \(x\pm dx\) distance from the source is given by the absorption reaction rate divided by the source strength in that direction, multiplied by \(dx\):

\beq
p_{abs}(x)dx=\frac{\Sigma_aL}{2D}e^{-x/L}dx
\eeq

The average of the square of the distance traveled from the source to a point \(x\) is then defined as:

\beqa
\langle x^2\rangle\equiv&\int_0^\infty x^2p_{abs}(x)dx\\
=&L^2
\eeqa

Hence, the \gls{rms} distance traveled from the source to a point \(x\) is again proportional to \(L\).

